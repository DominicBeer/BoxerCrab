using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using SpaceIndex;
using System.Linq;
using System.Diagnostics;
namespace SpaceStoreTests
{
    [TestClass]
    public class WholeBehaviourTests
    {
        [TestMethod]
        public void SimpleClashes1()
        {
            var min1 = new Point3d(-18.382822, -16.933224, 0);
            var min2 = new Point3d(2.69658, 14.936227, 10.475848);
            var min3 = new Point3d(-16.60232, -3.519625, 4.79854);
            var max1 = new Point3d(8.837872, 15.938457, 18.781854);
            var max2 = new Point3d(31.964786, 64.876488, 22.794251);
            var max3 = new Point3d(-3.01831, 6.88675, 10.444734);
            var box1 = new Box(min1, max1);
            var box2 = new Box(min2, max2);
            var box3 = new Box(min3, max3);
            var boxes = new Box[] { box1, box2, box3 };

            var pairs = Engine.GetSelfIntersectingPairs(boxes,0.001);
            pairs.ToList().ForEach(p => Console.WriteLine(p));
            Assert.IsTrue((new (int, int)[] { (0, 1), (0, 2) }).SequenceEqual(pairs));
            Console.WriteLine("Done");
        }

        [TestMethod]
        public void SimpleClashes2()
        {
            var min1 = new Point3d(-18, -17, 0);
            var min2 = new Point3d(-28.9445, -8.42937, 2.84059);
            
            var max1 = new Point3d(9, 16, 19);
            var max2 = new Point3d(18.8799, 10.0563, 9.37707);
           
            var box1 = new Box(min1, max1);
            var box2 = new Box(min2, max2);
            
            var boxes = new Box[] { box1, box2};

            var pairs = Engine.GetSelfIntersectingPairs(boxes, 0.001);
            pairs.ToList().ForEach(p => Console.WriteLine(p));
            Assert.IsTrue((new (int, int)[] { (0, 1)}).SequenceEqual( pairs));
            Console.WriteLine("Done");


        }

        [TestMethod]
        public void SimpleClashes2AsSets()
        {
            var min1 = new Point3d(-18, -17, 0);
            var min2 = new Point3d(-28.9445, -8.42937, 2.84059);

            var max1 = new Point3d(9, 16, 19);
            var max2 = new Point3d(18.8799, 10.0563, 9.37707);

            var min3 = new Point3d(-9, -16, -19);
            var max3 = new Point3d(18.8799, 10.0563, -10);

            var box1 = new Box(min1, max1);
            var box2 = new Box(min2, max2);
            var box3 = new Box(min3, max3);

            var boxes1 = new Box[] { box1};
            var boxes2 = new Box[] { box3 , box2 };

            var pairs = Engine.GetIntersectingPairs(boxes1, boxes2, 0.001);
            pairs.ToList().ForEach(p => Console.WriteLine(p));
            //Assert.IsTrue((new (int, int)[] { (0, 0) }).SequenceEqual(pairs));
            Console.WriteLine("Done");


        }
        [TestMethod]
        public void _300ClashesWithPerformanceTests()
        {

            //Data imported from a grasshopper script.
            //Results generated in GH using Grasshoppers One|Many collision generation. 
            //For 300 cubes this takes around 30 seconds brute forcing all the combinations.
            //Here we test for the same number of collisions in under 1ms. ~30000 x speedup!
            var coords = new double[][] {
                new double[]{90.739186, 141.339473, 150.292525, 100.15196, 155.730014, 150.855311},
                new double[]{199.232581, 39.047566, 141.700378, 207.796256, 40.689985, 158.130411},
                new double[]{76.66455, 18.92961, 161.19467, 81.262086, 34.187145, 172.08776},
                new double[]{32.407278, 37.674572, 42.941867, 42.224318, 39.72183, 45.519226},
                new double[]{116.20032, 59.280719, 139.523291, 129.345486, 61.439686, 142.431804},
                new double[]{79.592773, 104.198797, 24.319759, 81.350708, 111.489708, 32.330959},
                new double[]{33.276421, 34.238523, 193.553388, 37.929047, 46.885081, 207.240605},
                new double[]{141.364158, 25.628891, 151.540859, 167.365237, 32.445962, 159.66678},
                new double[]{118.425771, 129.621989, 108.141097, 118.893467, 146.416857, 118.25125},
                new double[]{124.887618, 0.779193, 109.347878, 127.051813, 22.077498, 122.812245},
                new double[]{162.001393, 83.993141, 164.337653, 181.246699, 89.339395, 170.632185},
                new double[]{182.388713, 70.899257, 63.894864, 202.320829, 83.121584, 70.042472},
                new double[]{160.618571, 58.713671, 156.808771, 167.817099, 60.758475, 169.864765},
                new double[]{136.071768, 12.438461, 25.967328, 164.166717, 21.058798, 35.916341},
                new double[]{54.199888, 9.766781, 165.333673, 57.20158, 17.241674, 173.390893},
                new double[]{43.15185, 159.080393, 12.171108, 52.042439, 164.292731, 14.48527},
                new double[]{128.888111, 102.57973, 139.109176, 131.061916, 113.056254, 150.666557},
                new double[]{39.089096, 10.725659, 86.847285, 52.342498, 18.841315, 98.764338},
                new double[]{44.586236, 159.722319, 170.373339, 63.777062, 169.7346, 187.176788},
                new double[]{110.136932, 48.893052, 124.811346, 112.330485, 58.027911, 131.104278},
                new double[]{28.961377, 159.260639, 131.207138, 39.835792, 163.513173, 149.607654},
                new double[]{111.758399, 196.296953, 48.158397, 113.935342, 212.681597, 48.415085},
                new double[]{88.04762, 123.2547, 21.299607, 110.409163, 127.887075, 27.141574},
                new double[]{170.423738, 9.185881, 47.948025, 172.884846, 20.115975, 49.264498},
                new double[]{29.101488, 192.169972, 50.753393, 34.512645, 205.542137, 54.105464},
                new double[]{162.059197, 115.392592, 131.563814, 172.708958, 116.596233, 152.949566},
                new double[]{179.155378, 116.368315, 53.581253, 189.076097, 120.867887, 53.809377},
                new double[]{164.1572, 82.134194, 62.949014, 184.02041, 94.787932, 80.937011},
                new double[]{144.88432, 77.545945, 147.369743, 149.362182, 88.332336, 158.977386},
                new double[]{128.69543, 18.902502, 141.786685, 140.910898, 24.250504, 161.807374},
                new double[]{112.632182, 194.675463, 181.203806, 128.537244, 220.154797, 207.92953},
                new double[]{45.329737, 142.276661, 39.223584, 57.179732, 149.366408, 49.835419},
                new double[]{180.342297, 131.750895, 20.321666, 194.644788, 155.336447, 32.223127},
                new double[]{27.20661, 4.894128, 149.904535, 28.370191, 13.368862, 159.331043},
                new double[]{181.679337, 171.435986, 98.354809, 194.656191, 174.448153, 122.657033},
                new double[]{86.731654, 60.384919, 34.038185, 89.192688, 71.314688, 35.354619},
                new double[]{64.248547, 66.050261, 100.529085, 65.964664, 80.425422, 109.721347},
                new double[]{76.61518, 175.131207, 40.970123, 83.265516, 196.414482, 41.012276},
                new double[]{158.680951, 34.662055, 110.643158, 181.952483, 48.914809, 117.789812},
                new double[]{91.088045, 160.384725, 29.681405, 101.492346, 163.43706, 39.089125},
                new double[]{180.554862, 82.517384, 184.479906, 192.020417, 83.929125, 207.372126},
                new double[]{29.143841, 182.756635, 178.016664, 34.950326, 204.080471, 200.396089},
                new double[]{79.353716, 190.116127, 142.525775, 95.327983, 194.08727, 147.315844},
                new double[]{90.166721, 37.8177, 185.46868, 99.556649, 42.348853, 186.171492},
                new double[]{136.778721, 160.531259, 47.121623, 159.118197, 174.905828, 62.538916},
                new double[]{120.700022, 183.599699, 142.014313, 127.363671, 186.07292, 153.440595},
                new double[]{129.035056, 46.083867, 195.809788, 143.918705, 53.248948, 208.685807},
                new double[]{56.343674, 119.338091, 182.332509, 65.758264, 147.987049, 189.14746},
                new double[]{164.599818, 128.328697, 187.572512, 170.123972, 149.630117, 209.947202},
                new double[]{56.930608, 143.20082, 29.471033, 67.417582, 145.216749, 37.754654},
                new double[]{48.42175, 123.022249, 93.137685, 68.139692, 135.853891, 100.543453},
                new double[]{181.006897, 135.990078, 58.29615, 187.60701, 158.373891, 74.217758},
                new double[]{121.747424, 14.207491, 2.182494, 123.631065, 24.554041, 13.104745},
                new double[]{112.391503, 140.788264, 169.185026, 126.582247, 150.009075, 174.489912},
                new double[]{42.301563, 86.433581, 130.565599, 50.764685, 114.200379, 150.429035},
                new double[]{187.067268, 185.806112, 47.382782, 200.275682, 187.591095, 49.947142},
                new double[]{119.271441, 123.879347, 161.164363, 129.597309, 125.294693, 163.187639},
                new double[]{147.004403, 154.992383, 121.333126, 164.416036, 156.860497, 136.63779},
                new double[]{11.392271, 53.591081, 137.437127, 22.615992, 56.14377, 147.485465},
                new double[]{162.227604, 89.136781, 111.560895, 164.018026, 95.6189, 118.653784},
                new double[]{108.523875, 195.916962, 83.310049, 109.779483, 204.440825, 83.583309},
                new double[]{14.367875, 97.352983, 138.690855, 16.412764, 103.858462, 145.777018},
                new double[]{100.081256, 93.3316, 44.934708, 102.172904, 100.724744, 53.018007},
                new double[]{134.978995, 23.291031, 174.440893, 153.111448, 31.420901, 174.689499},
                new double[]{61.989153, 46.867321, 136.230552, 80.34035, 56.410539, 160.383862},
                new double[]{124.758136, 149.802961, 37.685612, 132.612504, 176.424677, 56.623551},
                new double[]{147.29507, 147.234843, 51.659679, 162.703966, 153.630219, 64.724121},
                new double[]{141.498441, 199.068196, 14.990716, 153.909473, 205.209607, 25.770994},
                new double[]{57.993849, 49.088956, 177.346236, 65.414026, 52.62872, 177.828533},
                new double[]{17.201952, 61.953405, 139.381969, 23.337322, 84.31914, 155.102625},
                new double[]{186.989784, 101.116613, 119.728504, 191.007436, 109.527921, 128.711784},
                new double[]{102.006647, 72.697177, 106.225534, 114.006081, 76.352521, 110.450162},
                new double[]{25.656799, 25.797321, 184.290607, 40.299771, 27.672853, 197.202916},
                new double[]{161.584672, 40.101185, 85.940588, 187.601696, 57.075204, 104.09847},
                new double[]{137.66855, 111.624322, 181.095032, 159.120066, 124.297875, 186.852226},
                new double[]{145.06619, 184.590485, 161.276954, 145.685671, 202.710129, 172.231635},
                new double[]{177.653336, 14.267306, 50.881276, 187.448254, 19.239064, 59.42167},
                new double[]{143.129553, 93.52348, 43.917407, 150.672593, 116.609894, 49.359668},
                new double[]{41.731498, 56.741103, 8.912882, 51.784578, 63.089701, 10.57257},
                new double[]{116.487947, 153.818927, 53.987734, 118.580158, 161.214064, 62.073212},
                new double[]{178.272795, 77.395206, 81.00268, 188.907799, 77.623428, 90.227014},
                new double[]{68.060358, 142.278878, 16.497398, 74.278248, 152.330868, 21.723612},
                new double[]{144.806036, 99.054151, 20.625156, 159.87065, 106.721439, 22.463922},
                new double[]{137.687429, 79.593778, 125.98519, 138.230467, 86.359901, 133.561441},
                new double[]{88.360161, 41.128907, 193.897654, 98.284063, 42.685564, 213.331352},
                new double[]{139.711766, 3.934038, 68.15631, 141.769595, 15.75169, 81.244507},
                new double[]{131.668794, 73.317824, 77.804681, 143.565886, 77.890203, 98.026679},
                new double[]{76.037275, 136.211284, 59.223121, 89.251791, 144.734823, 68.360778},
                new double[]{25.668638, 126.547027, 27.425417, 33.859901, 129.112657, 42.010494},
                new double[]{2.698549, 130.878528, 59.058507, 13.34118, 147.111106, 59.76275},
                new double[]{71.06163, 144.592053, 113.637414, 80.125969, 147.031089, 121.803673},
                new double[]{125.330624, 56.306532, 124.444613, 140.737279, 62.700978, 137.507156},
                new double[]{168.824327, 129.626606, 153.266712, 171.500335, 147.502118, 172.176189},
                new double[]{4.539828, 90.773928, 39.845854, 19.271216, 96.031919, 52.113173},
                new double[]{127.812824, 172.554243, 58.942899, 139.707832, 177.125821, 79.161354},
                new double[]{111.435641, 34.898118, 53.875531, 111.454633, 46.556507, 60.768488},
                new double[]{32.664003, 139.158752, 141.168437, 37.036029, 158.756064, 154.532173},
                new double[]{152.461201, 16.558813, 176.171363, 155.081685, 28.106757, 177.585247},
                new double[]{77.911284, 136.199033, 98.971845, 89.436374, 143.287246, 102.564142},
                new double[]{157.269239, 155.976952, 154.684665, 168.433892, 158.39387, 175.79156},
                new double[]{118.653606, 77.128447, 2.926178, 130.54599, 78.061051, 4.606525},
                new double[]{195.623096, 192.264324, 188.905553, 196.571485, 201.979501, 199.762},
                new double[]{101.951243, 78.335616, 150.234927, 120.872976, 89.595908, 162.498215},
                new double[]{155.484347, 74.461772, 56.277024, 167.762993, 77.956253, 60.370814},
                new double[]{78.027304, 50.170688, 22.314072, 89.658918, 57.270418, 32.766925},
                new double[]{58.986646, 195.573726, 194.998631, 64.553303, 219.422443, 211.362259},
                new double[]{100.598752, 159.926474, 19.254196, 101.937673, 171.25529, 31.883508},
                new double[]{168.249233, 119.35496, 28.81345, 182.178708, 142.799822, 40.281804},
                new double[]{182.809434, 174.412596, 28.853586, 195.088595, 177.907224, 32.947547},
                new double[]{42.484027, 109.929577, 177.375126, 48.145184, 110.957657, 179.009745},
                new double[]{154.662585, 179.625286, 141.75016, 164.463428, 184.600051, 150.295721},
                new double[]{121.390542, 175.60452, 29.818499, 126.906792, 176.167673, 34.046428},
                new double[]{50.521559, 1.852697, 120.506724, 57.754148, 3.142041, 134.49411},
                new double[]{102.990805, 45.020808, 91.535874, 112.929156, 47.32739, 99.489172},
                new double[]{129.203463, 115.342993, 38.644696, 145.147185, 116.649818, 40.95014},
                new double[]{185.712171, 198.886738, 12.061305, 204.399777, 209.224128, 36.249479},
                new double[]{77.648319, 101.90025, 167.799416, 88.28502, 102.128509, 177.025222},
                new double[]{12.127544, 21.824302, 127.035998, 16.909964, 32.686355, 138.689504},
                new double[]{191.867489, 190.248604, 125.791892, 220.903446, 209.263145, 136.91033},
                new double[]{130.363867, 51.019764, 171.67566, 149.025483, 60.043762, 187.830493},
                new double[]{138.337996, 84.571617, 63.482349, 145.565361, 105.733177, 68.826425},
                new double[]{79.344276, 156.272213, 137.685212, 93.035585, 164.093739, 140.881802},
                new double[]{123.916283, 176.122587, 132.813953, 147.965432, 191.141668, 149.015204},
                new double[]{0.543953, 63.459081, 126.374209, 20.019869, 74.078437, 130.015278},
                new double[]{49.741739, 62.610006, 33.831036, 59.194981, 77.50451, 49.433891},
                new double[]{6.907814, 190.058735, 140.532545, 14.238348, 193.646364, 141.171054},
                new double[]{36.783738, 88.319225, 2.692538, 47.006814, 93.705716, 16.101637},
                new double[]{29.203451, 80.272047, 89.693407, 44.708308, 85.095849, 95.245936},
                new double[]{179.020502, 75.633422, 172.246343, 193.197897, 79.419341, 176.741231},
                new double[]{66.996499, 21.974858, 39.791044, 81.634253, 24.282547, 52.757422},
                new double[]{120.488668, 95.16545, 28.194997, 142.150708, 107.259334, 41.541494},
                new double[]{170.440789, 110.280036, 82.796394, 188.248549, 119.517468, 98.374977},
                new double[]{10.466923, 198.088039, 90.194217, 29.730333, 203.275347, 96.341883},
                new double[]{29.710913, 46.012806, 199.476872, 42.024307, 52.834684, 201.97186},
                new double[]{47.568058, 84.77696, 59.148037, 62.279398, 91.54069, 71.792171},
                new double[]{190.73618, 134.864599, 37.345781, 197.963613, 156.026357, 42.689907},
                new double[]{69.710533, 72.029742, 74.348952, 72.677366, 87.86349, 75.576745},
                new double[]{197.40817, 32.67886, 172.434612, 202.095649, 49.905048, 184.527169},
                new double[]{4.908779, 37.509571, 111.757599, 15.528931, 38.087317, 133.791451},
                new double[]{37.459995, 190.803836, 6.985503, 63.800427, 199.102895, 16.515455},
                new double[]{184.361668, 189.256218, 98.63583, 203.514248, 192.756267, 103.20379},
                new double[]{171.506041, 3.696581, 98.724948, 173.107792, 15.1735, 106.158749},
                new double[]{133.991432, 65.400106, 133.970953, 154.435626, 77.345291, 147.028784},
                new double[]{128.433265, 161.866105, 58.136771, 150.084337, 175.562634, 65.565734},
                new double[]{193.284618, 96.501896, 62.557001, 197.804983, 118.57081, 77.441142},
                new double[]{94.919742, 114.236187, 133.552632, 115.023145, 124.187784, 135.505387},
                new double[]{82.895546, 199.702489, 116.509432, 83.455323, 219.566562, 137.686705},
                new double[]{73.920003, 92.692279, 69.817319, 81.045463, 103.802235, 75.912203},
                new double[]{20.58502, 183.517416, 9.287639, 38.341999, 191.04292, 38.673204},
                new double[]{87.349307, 118.916159, 54.968074, 93.708869, 143.57358, 80.870231},
                new double[]{146.358865, 141.084349, 94.162596, 168.860499, 146.297585, 100.555352},
                new double[]{165.785113, 62.583104, 159.381094, 167.935699, 81.722608, 185.052273},
                new double[]{168.680193, 129.911627, 195.628124, 173.004541, 150.436803, 209.520314},
                new double[]{51.148835, 93.26575, 135.382665, 72.29451, 104.387249, 163.131603},
                new double[]{164.179897, 183.976878, 99.288797, 172.985217, 211.821573, 119.338341},
                new double[]{184.557983, 128.942715, 73.327446, 195.295245, 135.024786, 75.741585},
                new double[]{79.793293, 24.228218, 64.17808, 79.804374, 28.765552, 69.304646},
                new double[]{46.655944, 160.125189, 169.109372, 68.522159, 172.651755, 182.858635},
                new double[]{50.991262, 61.585483, 167.694642, 62.675917, 65.716973, 187.963851},
                new double[]{79.205971, 5.360607, 27.030181, 84.521995, 15.186815, 31.179662},
                new double[]{125.804326, 52.503155, 137.554747, 127.378851, 66.029485, 151.894114},
                new double[]{174.996719, 87.740908, 137.64727, 180.803387, 109.065416, 160.027399},
                new double[]{134.477385, 147.322955, 1.815761, 151.704281, 156.807363, 24.142894},
                new double[]{61.061588, 2.171455, 101.634085, 69.287533, 27.115336, 119.733265},
                new double[]{130.08184, 160.01278, 157.26661, 131.428747, 172.136136, 170.123047},
                new double[]{192.308277, 181.916793, 4.20242, 205.093533, 204.815296, 28.417477},
                new double[]{119.0101, 185.602962, 147.710762, 130.542076, 187.759371, 150.506829},
                new double[]{166.0593, 163.926372, 66.278507, 171.174494, 176.805516, 80.168371},
                new double[]{0.671401, 168.330328, 73.151429, 13.510627, 173.099316, 95.162887},
                new double[]{146.553763, 30.212111, 9.385396, 158.003489, 37.578497, 11.583337},
                new double[]{124.088119, 134.943476, 145.798834, 125.347214, 146.518144, 153.150073},
                new double[]{25.488803, 14.470044, 3.451285, 36.135856, 15.673379, 24.831598},
                new double[]{152.467418, 87.916149, 160.527053, 163.361519, 94.421014, 161.47629},
                new double[]{162.493974, 144.693422, 64.055043, 176.897778, 148.084632, 76.966057},
                new double[]{91.250853, 7.0122, 122.773547, 95.813314, 30.562283, 138.549668},
                new double[]{79.403498, 26.12369, 110.006055, 94.276598, 31.618916, 135.537582},
                new double[]{90.601498, 98.958588, 44.477851, 93.222307, 110.507965, 45.891911},
                new double[]{140.731672, 159.505136, 82.763663, 153.005064, 167.007072, 84.226179},
                new double[]{119.830879, 112.205839, 167.418626, 120.325252, 116.15343, 171.815761},
                new double[]{162.908478, 156.4603, 150.012121, 168.988661, 156.746751, 154.585331},
                new double[]{69.260922, 102.92779, 32.109594, 86.557101, 112.711189, 32.383771},
                new double[]{108.112389, 3.713426, 140.9617, 116.390985, 16.588127, 141.068867},
                new double[]{58.352148, 42.003285, 88.492249, 64.535836, 44.465949, 98.905068},
                new double[]{36.919849, 164.803744, 125.364749, 38.535982, 174.682801, 131.860778},
                new double[]{128.724115, 88.97699, 186.39204, 140.62509, 89.744772, 196.783879},
                new double[]{99.952208, 40.668827, 14.062557, 101.997404, 47.175282, 21.149784},
                new double[]{9.847076, 21.132, 32.416924, 30.664274, 25.565989, 37.968675},
                new double[]{167.404569, 112.908769, 162.898032, 176.23593, 138.990537, 181.917093},
                new double[]{178.102559, 111.769644, 140.951666, 181.961422, 127.431286, 151.780984},
                new double[]{8.258728, 101.082899, 193.907071, 28.631828, 114.467649, 198.44639},
                new double[]{119.029368, 118.722861, 118.416355, 129.446933, 124.853481, 121.169192},
                new double[]{72.788306, 161.63827, 50.488234, 74.177019, 168.791659, 58.392075},
                new double[]{154.503389, 20.827093, 149.988624, 155.264318, 28.853927, 158.50973},
                new double[]{133.789289, 81.88268, 29.976072, 158.162861, 88.500427, 51.942791},
                new double[]{119.742149, 146.387162, 77.517237, 136.148549, 154.788453, 79.61112},
                new double[]{154.613604, 109.601791, 169.075041, 156.187681, 118.469247, 173.14559},
                new double[]{77.792247, 159.975044, 42.157841, 87.168241, 163.576085, 58.09736},
                new double[]{81.016325, 112.962368, 144.908411, 85.102896, 113.54102, 148.082558},
                new double[]{110.922968, 9.939805, 108.956641, 111.734106, 16.835827, 125.889305},
                new double[]{104.577759, 122.671584, 108.088298, 125.140486, 135.78618, 111.775501},
                new double[]{121.158296, 136.719705, 193.92835, 123.301339, 145.714125, 203.81469},
                new double[]{62.084899, 76.539708, 195.479579, 65.134667, 93.889336, 206.974521},
                new double[]{81.335082, 27.963369, 37.429481, 91.376337, 29.795818, 39.821986},
                new double[]{177.632674, 161.391785, 145.150896, 200.296508, 174.211554, 150.214301},
                new double[]{171.347668, 129.221337, 54.417894, 172.54124, 141.374819, 59.362966},
                new double[]{66.118716, 134.700785, 35.959965, 92.91268, 151.393871, 60.126649},
                new double[]{21.404176, 182.753435, 144.102695, 36.956849, 192.320274, 146.093026},
                new double[]{151.434873, 97.789749, 181.306798, 154.693343, 108.891313, 193.429385},
                new double[]{105.146636, 31.502204, 157.857773, 116.250176, 38.752037, 165.612113},
                new double[]{92.86288, 165.939669, 197.369222, 98.701095, 188.908577, 221.503468},
                new double[]{39.205139, 38.070608, 69.613187, 41.655184, 47.663594, 79.692081},
                new double[]{84.310275, 105.486673, 189.500897, 91.256263, 125.900402, 194.62664},
                new double[]{72.073719, 88.682941, 9.777226, 81.710218, 91.983783, 17.765795},
                new double[]{33.331438, 50.373838, 25.769001, 38.086379, 72.503206, 40.784886},
                new double[]{155.193703, 47.681472, 3.007067, 168.443977, 69.604613, 14.014135},
                new double[]{162.940591, 152.391146, 4.679527, 178.215882, 157.427498, 10.414442},
                new double[]{124.731051, 190.986276, 194.403675, 140.498936, 195.4529, 199.64134},
                new double[]{42.80619, 32.252928, 180.052429, 62.63414, 43.818696, 185.108235},
                new double[]{140.423954, 16.795882, 60.490699, 148.077306, 20.017024, 66.991215},
                new double[]{175.378286, 31.915496, 88.452707, 202.480672, 49.468375, 98.481309},
                new double[]{127.709855, 1.548385, 179.871977, 128.743928, 7.826256, 194.79917},
                new double[]{64.177074, 176.295611, 130.061384, 67.850599, 198.681151, 153.719833},
                new double[]{196.043222, 164.728271, 133.413321, 202.84362, 165.127923, 138.548859},
                new double[]{137.661327, 12.496083, 87.330839, 140.139059, 24.168598, 99.628841},
                new double[]{77.258112, 56.737904, 36.217695, 83.331531, 59.318998, 46.260317},
                new double[]{196.548467, 181.391687, 103.39708, 197.564179, 190.466476, 113.521009},
                new double[]{79.071895, 1.729431, 61.549141, 91.921106, 5.214524, 85.041145},
                new double[]{131.249673, 151.282123, 138.637462, 141.486311, 157.996873, 142.577237},
                new double[]{50.838305, 101.907678, 194.624287, 50.94842, 111.055269, 207.246487},
                new double[]{144.72373, 138.174, 98.94716, 159.66067, 145.487106, 100.253271},
                new double[]{105.212668, 11.397299, 13.096868, 118.924986, 19.959455, 15.140259},
                new double[]{17.671654, 131.244874, 12.140983, 17.78451, 149.674187, 37.612365},
                new double[]{37.895184, 157.651812, 14.570613, 42.054832, 179.623304, 29.249533},
                new double[]{23.339601, 197.620736, 109.064045, 23.915156, 206.609732, 114.608388},
                new double[]{91.483898, 27.827075, 164.170251, 97.885625, 48.406068, 178.944751},
                new double[]{119.747566, 171.636736, 86.363732, 134.880875, 176.78773, 92.195781},
                new double[]{34.863787, 120.998712, 7.133637, 35.524328, 138.360638, 30.91669},
                new double[]{25.968128, 88.69798, 88.590006, 33.672206, 111.768035, 89.354865},
                new double[]{73.658661, 76.345998, 79.033335, 83.002983, 91.590683, 86.85155},
                new double[]{7.854053, 99.524859, 158.518555, 31.400113, 113.262197, 159.840603},
                new double[]{86.634513, 3.164046, 119.693579, 90.813281, 20.499483, 131.642377},
                new double[]{170.983746, 131.428732, 59.196607, 183.453459, 134.773416, 82.037373},
                new double[]{103.021524, 26.655219, 150.288914, 120.775977, 34.179653, 179.670299},
                new double[]{30.488333, 91.078629, 151.668924, 33.776018, 105.177187, 153.495456},
                new double[]{177.140069, 71.098772, 69.542538, 186.936604, 76.071351, 78.084342},
                new double[]{138.32051, 158.484842, 137.001938, 143.910364, 179.130946, 151.483672},
                new double[]{41.478179, 113.71892, 185.959662, 55.387442, 117.696702, 197.285707},
                new double[]{66.420605, 115.70191, 27.821041, 76.67013, 132.695472, 36.326244},
                new double[]{123.844239, 179.449862, 139.540548, 139.256081, 185.846461, 152.607488},
                new double[]{197.565149, 139.24467, 18.086363, 206.072929, 143.536112, 25.497457},
                new double[]{175.131207, 126.701995, 182.757846, 199.289164, 142.425017, 199.585126},
                new double[]{180.234711, 72.97077, 70.191892, 201.88983, 86.578349, 89.753814},
                new double[]{85.841025, 41.41514, 92.504192, 97.61527, 45.727596, 112.759136},
                new double[]{80.793337, 123.272962, 165.752588, 92.328359, 125.429941, 168.549394},
                new double[]{122.116557, 129.20968, 136.302802, 123.220599, 148.010608, 156.307584},
                new double[]{65.067703, 105.672748, 9.11562, 80.006069, 112.986552, 10.421856},
                new double[]{74.128158, 119.897917, 70.152739, 79.756246, 120.800289, 74.551649},
                new double[]{88.922409, 23.553766, 95.347297, 90.796136, 44.739503, 123.957858},
                new double[]{108.461043, 112.740362, 117.019682, 111.137381, 130.618079, 135.931492},
                new double[]{120.047856, 60.401193, 159.107295, 130.372351, 61.816352, 161.130302},
                new double[]{132.295475, 78.220008, 182.497304, 139.949656, 81.441499, 188.998524},
                new double[]{2.726046, 176.719966, 13.551713, 6.717583, 188.430928, 14.057186},
                new double[]{4.197985, 99.483488, 194.768991, 25.758771, 101.731077, 198.334244},
                new double[]{168.509387, 38.576858, 66.997094, 186.713635, 48.899099, 83.1512},
                new double[]{132.898866, 99.791024, 129.521009, 147.893853, 109.487436, 139.911082},
                new double[]{29.619966, 52.074388, 170.043747, 37.444546, 78.025399, 188.573387},
                new double[]{191.663745, 155.921342, 120.178938, 208.106417, 166.235229, 125.663815},
                new double[]{56.820599, 3.633749, 45.961836, 66.734809, 6.810759, 49.598499},
                new double[]{149.93402, 30.633243, 6.847404, 162.895741, 33.315277, 18.415683},
                new double[]{43.532617, 21.29339, 61.89199, 46.401148, 31.574736, 69.138361},
                new double[]{177.810521, 39.478915, 142.794545, 180.722002, 49.623289, 153.880505},
                new double[]{11.334467, 47.53695, 51.062323, 12.213289, 60.523034, 59.09142},
                new double[]{177.23401, 59.508347, 46.267748, 190.465493, 61.052547, 48.609325},
                new double[]{140.656382, 62.519677, 47.220798, 144.472223, 76.262441, 49.694956},
                new double[]{33.992426, 174.000104, 176.845608, 42.417236, 174.898613, 178.729421},
                new double[]{164.81259, 15.368307, 128.761851, 165.634232, 24.802861, 132.531632},
                new double[]{106.404204, 94.889046, 83.373888, 107.037534, 104.400341, 93.489118},
                new double[]{110.803543, 18.898297, 126.99305, 135.99921, 34.924712, 135.794803},
                new double[]{168.607738, 149.483791, 25.874782, 173.168406, 157.71482, 29.486124},
                new double[]{147.024083, 43.501716, 107.302238, 164.683264, 47.113295, 111.872231},
                new double[]{163.156769, 12.92142, 62.686072, 177.792526, 15.145153, 65.756629},
                new double[]{20.73777, 31.276175, 41.814581, 23.001259, 37.768478, 48.857396},
                new double[]{152.654088, 117.080915, 144.345568, 161.424907, 120.810322, 151.805096},
                new double[]{198.52181, 107.911663, 121.786578, 200.971354, 119.276989, 134.312571},
                new double[]{19.32624, 19.558486, 124.275794, 22.999947, 41.945132, 147.935413},
                new double[]{70.226611, 179.19012, 150.991456, 86.823005, 188.149123, 153.932784},
                new double[]{139.91711, 2.401277, 64.885445, 142.264033, 15.817362, 79.054524},
                new double[]{102.350501, 179.627503, 56.904505, 128.340519, 196.436142, 74.915122},
                new double[]{4.824461, 13.65971, 180.847724, 13.484395, 15.491397, 197.268303},
                new double[]{34.502676, 67.402981, 163.141112, 36.628795, 85.171885, 181.974137},
                new double[]{190.868063, 155.340237, 24.297473, 193.523886, 166.025897, 25.868017},
                new double[]{91.190032, 105.531426, 119.87282, 106.374176, 113.686031, 122.488691},
                new double[]{21.108503, 121.206272, 179.656805, 33.717977, 124.415694, 190.992075},
                new double[]{161.697286, 65.678522, 65.174694, 177.454699, 91.100381, 78.432434},
                new double[]{83.645058, 71.038568, 121.269905, 86.756223, 87.473392, 122.580298},
                new double[]{91.994948, 171.692734, 146.905457, 92.570601, 180.683255, 152.450741},
                new double[]{7.549352, 40.031724, 72.514096, 28.106356, 53.142671, 76.200272},
                new double[]{79.760791, 133.327015, 91.378301, 88.661842, 135.066756, 108.418539},
                new double[]{105.675948, 136.536259, 30.234396, 110.196821, 137.042203, 39.318438},
                new double[]{188.283694, 131.595927, 107.585271, 196.146797, 135.667899, 108.670125}
                };

            var results = new (int, int)[]
            {
                (11,244),
                (11,27),
                (115,165),
                (122,166),
                (122,245),
                (122,248),
                (139,148),
                (145,258),
                (149,205),
                (150,229),
                (166,248),
                (169,268),
                (174,175),
                (175,257),
                (18,157),
                (189,262),
                (204,241),
                (208,242),
                (244,251),
                (244,293),
                (252,257),
                (265,289),
                (27,251),
                (27,293),
                (30,216),
                (32,107),
                (32,290),
                (38,279),
                (39,106),
                (4,160),
                (44,143),
                (44,94),
                (45,122),
                (45,166),
                (45,248),
                (48,152),
                (49,205),
                (5,180),
                (6,133),
                (66,173),
                (7,192),
                (73,219),
                (8,199),
                (80,251),
                (85,286),
                (87,149),
                (87,205),
                (92,187),
                (94,143)
            }.ToHashSet();

            var boxes = coords.Select(arr => new Box(new Point3d(arr[0], arr[1], arr[2]), new Point3d(arr[3], arr[4], arr[5]))).ToList();
            
            //Tolerance must be 0.01 to match rhino test conditions
            var pairs = Engine.GetSelfIntersectingPairs(boxes, 0.01).ToHashSet();
            Console.WriteLine(pairs.Count);

            Assert.IsTrue(results.Except(pairs).Count() == 0);

            var sw = new Stopwatch();
            

            for (int i = 50; i <= boxes.Count; i += 50) 
            {
                sw.Restart();
                
                var b2 = boxes.Take(i);
                int n = -1;
                for (int j = 0; j < 100; j++)
                {
                    var p2 = Engine.GetSelfIntersectingPairs(b2, 0.01);
                    n = p2.Length;
                }
                sw.Stop();
                Console.WriteLine($"{b2.Count()} boxes intersected : 100 runs took {sw.ElapsedMilliseconds} ms : {n} clashes found ");
                
                Console.WriteLine();
            }


        }

        
    }
}
